{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/luked/Documents/slnsw/dxlab-art-index/components/BubbleChart/BubbleChart.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport render from 'd3-render';\nimport useDimensions from '../../lib/hooks/use-dimensions';\nimport css from './BubbleChart.module.scss';\n\nvar BubbleChart = function BubbleChart(_ref) {\n  _s();\n\n  var _ref$data = _ref.data,\n      data = _ref$data === void 0 ? [] : _ref$data,\n      _ref$height = _ref.height,\n      height = _ref$height === void 0 ? 200 : _ref$height,\n      _ref$bubblePadding = _ref.bubblePadding,\n      bubblePadding = _ref$bubblePadding === void 0 ? 3 : _ref$bubblePadding,\n      className = _ref.className,\n      renderBubble = _ref.renderBubble,\n      renderLabel = _ref.renderLabel,\n      onBubbleClick = _ref.onBubbleClick,\n      _ref$showValues = _ref.showValues,\n      showValues = _ref$showValues === void 0 ? true : _ref$showValues,\n      restProps = _objectWithoutProperties(_ref, [\"data\", \"height\", \"bubblePadding\", \"className\", \"renderBubble\", \"renderLabel\", \"onBubbleClick\", \"showValues\"]);\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      hoverIndex = _React$useState2[0],\n      setHoverIndex = _React$useState2[1];\n\n  var _useDimensions = useDimensions(),\n      _useDimensions2 = _slicedToArray(_useDimensions, 3),\n      svgRef = _useDimensions2[0],\n      dimensions = _useDimensions2[1],\n      svgNode = _useDimensions2[2];\n\n  var width = dimensions.width;\n  React.useEffect(function () {\n    // console.log(onBubbleClick);\n    if (svgNode && data.length > 0 && width) {\n      var root = pack(data, {\n        width: width,\n        height: height,\n        padding: bubblePadding\n      });\n      var circleData = root.leaves().map(function (d, i) {\n        if (typeof renderBubble === 'function') {\n          return renderBubble(d, i);\n        }\n\n        return {\n          append: 'g',\n          transform: \"translate(\".concat(d.x, \",\").concat(d.y, \")\"),\n          children: [{\n            append: 'circle',\n            data: d.data,\n            r: d.r,\n            fill: 'var(--colour-primary)',\n            onClick: onBubbleClick,\n            onMouseOver: function onMouseOver() {\n              setHoverIndex(i);\n            },\n            onMouseOut: function onMouseOut() {\n              setHoverIndex(null);\n            }\n          }]\n        };\n      });\n      var textData = root.leaves().map(function (d, i) {\n        var isHovered = i === hoverIndex;\n\n        if (typeof renderLabel === 'function') {\n          return renderLabel(d, i);\n        }\n\n        return {\n          append: 'g',\n          transform: \"translate(\".concat(d.x, \",\").concat(d.y, \")\"),\n          children: [{\n            append: 'text',\n            key: \"\".concat(isHovered),\n            fill: 'var(--colour-white)',\n            text: showValues || isHovered ? d.data.name : '',\n            y: function y(_, index, node) {\n              return \"\".concat(index - node.length / 2 + 0.8, \"em\");\n            }\n          }]\n        };\n      });\n      var renderData = [].concat(_toConsumableArray(circleData), _toConsumableArray(textData));\n      render(svgNode, renderData);\n    }\n  }, [svgNode, data, width, height, bubblePadding, renderBubble, renderLabel, onBubbleClick, showValues, hoverIndex]);\n  return __jsx(\"svg\", _extends({\n    ref: svgRef,\n    width: width,\n    height: height,\n    className: [css.bubbleChart, className || ''].join(' ')\n  }, restProps, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }));\n};\n\n_s(BubbleChart, \"9zFrSdaihg5pcjD7JUKJ9hFmRP8=\", false, function () {\n  return [useDimensions];\n});\n\n_c = BubbleChart;\n\nfunction pack(data, _ref2) {\n  var width = _ref2.width,\n      height = _ref2.height,\n      padding = _ref2.padding;\n  return d3.pack().size([width - 2, height - 2]).padding(padding)(d3.hierarchy({\n    children: data\n  }).sum(function (d) {\n    return d.value;\n  }));\n}\n\nBubbleChart.propTypes = {\n  className: PropTypes.string\n};\nexport default BubbleChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"BubbleChart\");","map":{"version":3,"sources":["/Users/luked/Documents/slnsw/dxlab-art-index/components/BubbleChart/BubbleChart.tsx"],"names":["React","PropTypes","d3","render","useDimensions","css","BubbleChart","data","height","bubblePadding","className","renderBubble","renderLabel","onBubbleClick","showValues","restProps","useState","hoverIndex","setHoverIndex","svgRef","dimensions","svgNode","width","useEffect","length","root","pack","padding","circleData","leaves","map","d","i","append","transform","x","y","children","r","fill","onClick","onMouseOver","onMouseOut","textData","isHovered","key","text","name","_","index","node","renderData","bubbleChart","join","size","hierarchy","sum","value","propTypes","string"],"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAO,KAAKC,EAAZ,MAAoB,IAApB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEA,OAAOC,aAAP,MAA0B,gCAA1B;AAEA,OAAOC,GAAP,MAAgB,2BAAhB;;AAiBA,IAAMC,WAA4B,GAAG,SAA/BA,WAA+B,OAW/B;AAAA;;AAAA,uBAVJC,IAUI;AAAA,MAVJA,IAUI,0BAVG,EAUH;AAAA,yBATJC,MASI;AAAA,MATJA,MASI,4BATK,GASL;AAAA,gCAPJC,aAOI;AAAA,MAPJA,aAOI,mCAPY,CAOZ;AAAA,MANJC,SAMI,QANJA,SAMI;AAAA,MALJC,YAKI,QALJA,YAKI;AAAA,MAJJC,WAII,QAJJA,WAII;AAAA,MAHJC,aAGI,QAHJA,aAGI;AAAA,6BAFJC,UAEI;AAAA,MAFJA,UAEI,gCAFS,IAET;AAAA,MADDC,SACC;;AAAA,wBACgCf,KAAK,CAACgB,QAAN,CAAe,IAAf,CADhC;AAAA;AAAA,MACGC,UADH;AAAA,MACeC,aADf;;AAAA,uBAEkCd,aAAa,EAF/C;AAAA;AAAA,MAEGe,MAFH;AAAA,MAEWC,UAFX;AAAA,MAEuBC,OAFvB;;AAAA,MAGIC,KAHJ,GAGcF,UAHd,CAGIE,KAHJ;AAKJtB,EAAAA,KAAK,CAACuB,SAAN,CAAgB,YAAM;AACpB;AAEA,QAAIF,OAAO,IAAId,IAAI,CAACiB,MAAL,GAAc,CAAzB,IAA8BF,KAAlC,EAAyC;AACvC,UAAMG,IAAI,GAAGC,IAAI,CAACnB,IAAD,EAAO;AAAEe,QAAAA,KAAK,EAALA,KAAF;AAASd,QAAAA,MAAM,EAANA,MAAT;AAAiBmB,QAAAA,OAAO,EAAElB;AAA1B,OAAP,CAAjB;AAEA,UAAMmB,UAAU,GAAGH,IAAI,CAACI,MAAL,GAAcC,GAAd,CAAkB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC7C,YAAI,OAAOrB,YAAP,KAAwB,UAA5B,EAAwC;AACtC,iBAAOA,YAAY,CAACoB,CAAD,EAAIC,CAAJ,CAAnB;AACD;;AAED,eAAO;AACLC,UAAAA,MAAM,EAAE,GADH;AAELC,UAAAA,SAAS,sBAAeH,CAAC,CAACI,CAAjB,cAAsBJ,CAAC,CAACK,CAAxB,MAFJ;AAGLC,UAAAA,QAAQ,EAAE,CACR;AACEJ,YAAAA,MAAM,EAAE,QADV;AAEE1B,YAAAA,IAAI,EAAEwB,CAAC,CAACxB,IAFV;AAGE+B,YAAAA,CAAC,EAAEP,CAAC,CAACO,CAHP;AAIEC,YAAAA,IAAI,EAAE,uBAJR;AAKEC,YAAAA,OAAO,EAAE3B,aALX;AAME4B,YAAAA,WAAW,EAAE,uBAAM;AACjBvB,cAAAA,aAAa,CAACc,CAAD,CAAb;AACD,aARH;AASEU,YAAAA,UAAU,EAAE,sBAAM;AAChBxB,cAAAA,aAAa,CAAC,IAAD,CAAb;AACD;AAXH,WADQ;AAHL,SAAP;AAmBD,OAxBkB,CAAnB;AA0BA,UAAMyB,QAAQ,GAAGlB,IAAI,CAACI,MAAL,GAAcC,GAAd,CAAkB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAC3C,YAAMY,SAAS,GAAGZ,CAAC,KAAKf,UAAxB;;AACA,YAAI,OAAOL,WAAP,KAAuB,UAA3B,EAAuC;AACrC,iBAAOA,WAAW,CAACmB,CAAD,EAAIC,CAAJ,CAAlB;AACD;;AAED,eAAO;AACLC,UAAAA,MAAM,EAAE,GADH;AAELC,UAAAA,SAAS,sBAAeH,CAAC,CAACI,CAAjB,cAAsBJ,CAAC,CAACK,CAAxB,MAFJ;AAGLC,UAAAA,QAAQ,EAAE,CACR;AACEJ,YAAAA,MAAM,EAAE,MADV;AAEEY,YAAAA,GAAG,YAAKD,SAAL,CAFL;AAGEL,YAAAA,IAAI,EAAE,qBAHR;AAIEO,YAAAA,IAAI,EAAEhC,UAAU,IAAI8B,SAAd,GAA0Bb,CAAC,CAACxB,IAAF,CAAOwC,IAAjC,GAAwC,EAJhD;AAKEX,YAAAA,CAAC,EAAE,WAACY,CAAD,EAAIC,KAAJ,EAAWC,IAAX;AAAA,+BAAuBD,KAAK,GAAGC,IAAI,CAAC1B,MAAL,GAAc,CAAtB,GAA0B,GAAjD;AAAA;AALL,WADQ;AAHL,SAAP;AAaD,OAnBgB,CAAjB;AAqBA,UAAM2B,UAAU,gCAAOvB,UAAP,sBAAsBe,QAAtB,EAAhB;AACAxC,MAAAA,MAAM,CAACkB,OAAD,EAAU8B,UAAV,CAAN;AACD;AACF,GAxDD,EAwDG,CACD9B,OADC,EAEDd,IAFC,EAGDe,KAHC,EAIDd,MAJC,EAKDC,aALC,EAMDE,YANC,EAODC,WAPC,EAQDC,aARC,EASDC,UATC,EAUDG,UAVC,CAxDH;AAqEA,SACE;AACE,IAAA,GAAG,EAAEE,MADP;AAEE,IAAA,KAAK,EAAEG,KAFT;AAGE,IAAA,MAAM,EAAEd,MAHV;AAIE,IAAA,SAAS,EAAE,CAACH,GAAG,CAAC+C,WAAL,EAAkB1C,SAAS,IAAI,EAA/B,EAAmC2C,IAAnC,CAAwC,GAAxC;AAJb,KAKMtC,SALN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF;AASD,CA9FD;;GAAMT,W;UAakCF,a;;;KAblCE,W;;AAgGN,SAASoB,IAAT,CAAcnB,IAAd,SAAgD;AAAA,MAA1Be,KAA0B,SAA1BA,KAA0B;AAAA,MAAnBd,MAAmB,SAAnBA,MAAmB;AAAA,MAAXmB,OAAW,SAAXA,OAAW;AAC9C,SAAOzB,EAAE,CACNwB,IADI,GAEJ4B,IAFI,CAEC,CAAChC,KAAK,GAAG,CAAT,EAAYd,MAAM,GAAG,CAArB,CAFD,EAGJmB,OAHI,CAGIA,OAHJ,EAGazB,EAAE,CAACqD,SAAH,CAAa;AAAElB,IAAAA,QAAQ,EAAE9B;AAAZ,GAAb,EAAiCiD,GAAjC,CAAqC,UAACzB,CAAD;AAAA,WAAOA,CAAC,CAAC0B,KAAT;AAAA,GAArC,CAHb,CAAP;AAID;;AAEDnD,WAAW,CAACoD,SAAZ,GAAwB;AACtBhD,EAAAA,SAAS,EAAET,SAAS,CAAC0D;AADC,CAAxB;AAIA,eAAerD,WAAf","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport render from 'd3-render';\n\nimport useDimensions from '../../lib/hooks/use-dimensions';\n\nimport css from './BubbleChart.module.scss';\n\ntype Props = {\n  data: {\n    name: string;\n    value: number;\n  }[];\n  height?: number;\n  // width?: number;\n  bubblePadding?: number;\n  className?: string;\n  renderBubble?: Function;\n  renderLabel?: Function;\n  onBubbleClick?: Function;\n  showValues?: boolean;\n};\n\nconst BubbleChart: React.FC<Props> = ({\n  data = [],\n  height = 200,\n  // width = 200,\n  bubblePadding = 3,\n  className,\n  renderBubble,\n  renderLabel,\n  onBubbleClick,\n  showValues = true,\n  ...restProps\n}) => {\n  const [hoverIndex, setHoverIndex] = React.useState(null);\n  const [svgRef, dimensions, svgNode] = useDimensions();\n  const { width } = dimensions;\n\n  React.useEffect(() => {\n    // console.log(onBubbleClick);\n\n    if (svgNode && data.length > 0 && width) {\n      const root = pack(data, { width, height, padding: bubblePadding });\n\n      const circleData = root.leaves().map((d, i) => {\n        if (typeof renderBubble === 'function') {\n          return renderBubble(d, i);\n        }\n\n        return {\n          append: 'g',\n          transform: `translate(${d.x},${d.y})`,\n          children: [\n            {\n              append: 'circle',\n              data: d.data,\n              r: d.r,\n              fill: 'var(--colour-primary)',\n              onClick: onBubbleClick,\n              onMouseOver: () => {\n                setHoverIndex(i);\n              },\n              onMouseOut: () => {\n                setHoverIndex(null);\n              },\n            },\n          ],\n        };\n      });\n\n      const textData = root.leaves().map((d, i) => {\n        const isHovered = i === hoverIndex;\n        if (typeof renderLabel === 'function') {\n          return renderLabel(d, i);\n        }\n\n        return {\n          append: 'g',\n          transform: `translate(${d.x},${d.y})`,\n          children: [\n            {\n              append: 'text',\n              key: `${isHovered}`,\n              fill: 'var(--colour-white)',\n              text: showValues || isHovered ? d.data.name : '',\n              y: (_, index, node) => `${index - node.length / 2 + 0.8}em`,\n            },\n          ],\n        };\n      });\n\n      const renderData = [...circleData, ...textData];\n      render(svgNode, renderData);\n    }\n  }, [\n    svgNode,\n    data,\n    width,\n    height,\n    bubblePadding,\n    renderBubble,\n    renderLabel,\n    onBubbleClick,\n    showValues,\n    hoverIndex,\n  ]);\n\n  return (\n    <svg\n      ref={svgRef}\n      width={width}\n      height={height}\n      className={[css.bubbleChart, className || ''].join(' ')}\n      {...restProps}\n    />\n  );\n};\n\nfunction pack(data, { width, height, padding }) {\n  return d3\n    .pack()\n    .size([width - 2, height - 2])\n    .padding(padding)(d3.hierarchy({ children: data }).sum((d) => d.value));\n}\n\nBubbleChart.propTypes = {\n  className: PropTypes.string,\n};\n\nexport default BubbleChart;\n"]},"metadata":{},"sourceType":"module"}