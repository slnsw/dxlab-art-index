{"ast":null,"code":"var _jsxFileName = \"/Users/luked/Documents/slnsw/dxlab-art-index/components/StackedBarChart/StackedBarChart.tsx\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport render from 'd3-render';\nimport useDimensions from '../../lib/hooks/use-dimensions';\nimport css from './StackedBarChart.module.scss';\nconst defaultMargin = {\n  top: 10,\n  left: 40,\n  right: 10,\n  bottom: 20\n};\n\nconst StackedBarChart = (_ref) => {\n  let {\n    data = [],\n    // width: propWidth,\n    height = 200,\n    margin: newMargin = defaultMargin,\n    direction = 'vertical',\n    rotateXAxis = false,\n    showValues = false,\n    renderBar,\n    id = 'bar-chart',\n    className\n  } = _ref,\n      restProps = _objectWithoutProperties(_ref, [\"data\", \"height\", \"margin\", \"direction\", \"rotateXAxis\", \"showValues\", \"renderBar\", \"id\", \"className\"]);\n\n  // const [hoverIndex, setHoverIndex] = React.useState(null);\n  const [svgRef, dimensions, svgNode] = useDimensions();\n  const {\n    width\n  } = dimensions;\n\n  const margin = _objectSpread(_objectSpread({}, defaultMargin), newMargin);\n\n  React.useEffect(() => {\n    if (svgNode && data.length > 0 && width) {\n      const columns = Object.keys(data[0]).map(key => key);\n      const series = d3.stack().keys(() => {\n        return columns.slice(1);\n      }).offset(d3.stackOffsetExpand)(data);\n      const x = d3.scaleTime().domain(d3.extent(data, d => {\n        return d.year;\n      })).range([margin.left, width - margin.right]);\n      const y = d3.scaleLinear().range([height - margin.bottom, margin.top]);\n      const area = d3.area().curve(d3.curveStep).x(d => x(d.data.year)).y0(d => y(d[0])).y1(d => y(d[1]));\n      const color = d3.scaleOrdinal().domain(columns.slice(1)).range(d3.schemeCategory10);\n\n      const xAxis = g => g.attr('transform', `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0).tickFormat(d3.format('d')));\n\n      const yAxis = g => g.attr('transform', `translate(${margin.left},0)`).call(d3.axisLeft(y).ticks(10, '%')).call(s => s.select('.domain').remove());\n\n      const renderData = [{\n        key: 'g',\n        append: 'g',\n        children: series.map((d, i) => {\n          return _objectSpread({\n            key: `${d.key}`,\n            append: 'path',\n            fill: color(d.key),\n            opacity: {\n              enter: 1,\n              exit: 0\n            },\n            d: {\n              enter: area(d),\n              exit: area(d)\n            },\n            duration: 1000\n          }, typeof renderBar === 'function' ? renderBar(d, i) : {});\n        })\n      }, {\n        append: 'g',\n        class: 'x-axis',\n        call: xAxis\n      }, {\n        append: 'g',\n        call: yAxis\n      }];\n      render(svgNode, renderData);\n\n      if (rotateXAxis) {\n        d3.selectAll(`#${id} .x-axis text`).style('text-anchor', 'end').attr('dx', '-1em').attr('dy', '-.5em').attr('transform', 'rotate(-90)');\n      }\n    }\n  }, [svgNode, data, width, height, margin, renderBar, rotateXAxis, id]);\n  return __jsx(\"svg\", _extends({\n    ref: svgRef,\n    width: width,\n    height: height,\n    id: id,\n    className: [css.stackedBarChart, className || ''].join(' ')\n  }, restProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 5\n    }\n  }));\n};\n\nStackedBarChart.propTypes = {\n  className: PropTypes.string\n};\nexport default StackedBarChart;","map":{"version":3,"sources":["/Users/luked/Documents/slnsw/dxlab-art-index/components/StackedBarChart/StackedBarChart.tsx"],"names":["React","PropTypes","d3","render","useDimensions","css","defaultMargin","top","left","right","bottom","StackedBarChart","data","height","margin","newMargin","direction","rotateXAxis","showValues","renderBar","id","className","restProps","svgRef","dimensions","svgNode","width","useEffect","length","columns","Object","keys","map","key","series","stack","slice","offset","stackOffsetExpand","x","scaleTime","domain","extent","d","year","range","y","scaleLinear","area","curve","curveStep","y0","y1","color","scaleOrdinal","schemeCategory10","xAxis","g","attr","call","axisBottom","ticks","tickSizeOuter","tickFormat","format","yAxis","axisLeft","s","select","remove","renderData","append","children","i","fill","opacity","enter","exit","duration","class","selectAll","style","stackedBarChart","join","propTypes","string"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport * as d3 from 'd3';\nimport render from 'd3-render';\n\nimport useDimensions from '../../lib/hooks/use-dimensions';\n\nimport css from './StackedBarChart.module.scss';\n\ntype Props = {\n  data: {\n    [key: string]: number;\n  }[];\n  height?: number;\n  margin?: {\n    top?: number;\n    left?: number;\n    right?: number;\n    bottom?: number;\n  };\n  direction?: 'vertical' | 'horizontal';\n  rotateXAxis?: boolean;\n  showValues?: boolean;\n  renderBar?: Function;\n  id?: string;\n  className?: string;\n};\n\nconst defaultMargin = {\n  top: 10,\n  left: 40,\n  right: 10,\n  bottom: 20,\n};\n\nconst StackedBarChart: React.FC<Props> = ({\n  data = [],\n  // width: propWidth,\n  height = 200,\n  margin: newMargin = defaultMargin,\n  direction = 'vertical',\n  rotateXAxis = false,\n  showValues = false,\n  renderBar,\n  id = 'bar-chart',\n  className,\n  ...restProps\n}) => {\n  // const [hoverIndex, setHoverIndex] = React.useState(null);\n  const [svgRef, dimensions, svgNode] = useDimensions();\n  const { width } = dimensions;\n  const margin = {\n    ...defaultMargin,\n    ...newMargin,\n  };\n\n  React.useEffect(() => {\n    if (svgNode && data.length > 0 && width) {\n      const columns = Object.keys(data[0]).map((key) => key);\n\n      const series = d3\n        .stack()\n        .keys(() => {\n          return columns.slice(1);\n        })\n        .offset(d3.stackOffsetExpand)(data);\n\n      const x = d3\n        .scaleTime()\n        .domain(\n          d3.extent(data, (d) => {\n            return d.year;\n          }),\n        )\n        .range([margin.left, width - margin.right]);\n\n      const y = d3.scaleLinear().range([height - margin.bottom, margin.top]);\n\n      const area = d3\n        .area()\n        .curve(d3.curveStep)\n        .x((d) => x(d.data.year))\n        .y0((d) => y(d[0]))\n        .y1((d) => y(d[1]));\n\n      const color = d3\n        .scaleOrdinal()\n        .domain(columns.slice(1))\n        .range(d3.schemeCategory10);\n\n      const xAxis = (g) =>\n        g.attr('transform', `translate(0,${height - margin.bottom})`).call(\n          d3\n            .axisBottom(x)\n            .ticks(width / 80)\n            .tickSizeOuter(0)\n            .tickFormat(d3.format('d')),\n        );\n\n      const yAxis = (g) =>\n        g\n          .attr('transform', `translate(${margin.left},0)`)\n          .call(d3.axisLeft(y).ticks(10, '%'))\n          .call((s) => s.select('.domain').remove());\n\n      const renderData = [\n        {\n          key: 'g',\n          append: 'g',\n          children: series.map((d, i) => {\n            return {\n              key: `${d.key}`,\n              append: 'path',\n              fill: color(d.key),\n              opacity: { enter: 1, exit: 0 },\n              d: { enter: area(d), exit: area(d) },\n              duration: 1000,\n              ...(typeof renderBar === 'function' ? renderBar(d, i) : {}),\n            };\n          }),\n        },\n        {\n          append: 'g',\n          class: 'x-axis',\n          call: xAxis,\n        },\n        {\n          append: 'g',\n          call: yAxis,\n        },\n      ];\n\n      render(svgNode, renderData);\n\n      if (rotateXAxis) {\n        d3.selectAll(`#${id} .x-axis text`)\n          .style('text-anchor', 'end')\n          .attr('dx', '-1em')\n          .attr('dy', '-.5em')\n          .attr('transform', 'rotate(-90)');\n      }\n    }\n  }, [svgNode, data, width, height, margin, renderBar, rotateXAxis, id]);\n\n  return (\n    <svg\n      ref={svgRef}\n      width={width}\n      height={height}\n      id={id}\n      className={[css.stackedBarChart, className || ''].join(' ')}\n      {...restProps}\n    />\n  );\n};\n\nStackedBarChart.propTypes = {\n  className: PropTypes.string,\n};\n\nexport default StackedBarChart;\n"]},"metadata":{},"sourceType":"module"}