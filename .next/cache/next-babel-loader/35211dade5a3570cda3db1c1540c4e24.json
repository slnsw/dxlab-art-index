{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _s = $RefreshSig$(),\n    _jsxFileName = \"/Users/luked/Documents/slnsw/dxlab-art-index/lib/contexts/art-index-context.tsx\",\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport * as React from 'react';\nimport * as d3 from 'd3';\nimport * as d3Array from 'd3-array';\nimport { arrayToCounts, processFormatsByGenderData, processFormatsByGenderToComparisonData, processPriceData, processWorksByYear } from '../art-index-utils';\nvar ArtIndexContext = /*#__PURE__*/React.createContext([]);\nvar defaultState = {\n  isWorksLoading: true,\n  isArtistsLoading: true,\n  works: [],\n  artists: [],\n  // Data for charts\n  priceData: [],\n  artistsGenderData: [],\n  formatByGenderData: [],\n  formatByGenderComparisonData: [],\n  genderYearData: [],\n  worksByYearData: [],\n  formatsData: {\n    all: [],\n    female: [],\n    male: [],\n    unknown: []\n  }\n};\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'FETCH_WORKS':\n      {\n        var works = action.payload;\n        var formatByGenderData = processFormatsByGenderData(works);\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isWorksLoading: false,\n          works: works,\n          priceData: processPriceData(works),\n          formatByGenderData: formatByGenderData,\n          formatByGenderComparisonData: processFormatsByGenderToComparisonData(formatByGenderData),\n          genderYearData: Array.from(d3Array.group(works, function (d) {\n            return d.exhibitionYear;\n          })).sort(function (a, b) {\n            return a[0] - b[0];\n          }).map(function (d) {\n            var year = d[0];\n            var allWorks = d[1];\n            return {\n              year: year,\n              malesTotal: allWorks.filter(function (work) {\n                return work.artistGender === 'male';\n              }).length,\n              femalesTotal: allWorks.filter(function (work) {\n                return work.artistGender === 'female';\n              }).length\n            };\n          }),\n          worksByYearData: processWorksByYear(works),\n          formatsData: {\n            all: arrayToCounts(works.map(function (work) {\n              return work.mediumFormat;\n            })),\n            male: arrayToCounts(works.filter(function (work) {\n              return work.artistGender === 'male';\n            }).map(function (work) {\n              return work.mediumFormat;\n            })),\n            female: arrayToCounts(works.filter(function (work) {\n              return work.artistGender === 'female';\n            }).map(function (work) {\n              return work.mediumFormat;\n            })),\n            unknown: arrayToCounts(works.filter(function (work) {\n              return work.artistGender === '';\n            }).map(function (work) {\n              return work.mediumFormat;\n            }))\n          }\n        });\n      }\n\n    case 'FETCH_ARTISTS':\n      {\n        var artists = action.payload;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isArtistsLoading: false,\n          artists: artists,\n          artistsGenderData: artists.map(function (d) {\n            return {\n              name: \"\".concat(d.firstName, \" \").concat(d.lastName),\n              value: parseInt(d.worksTotal, 10),\n              gender: d.gender\n            };\n          }).filter(function (d) {\n            return d.gender === 'male' || d.gender === 'female';\n          })\n        });\n      }\n\n    default:\n      {\n        throw new Error(\"Unsupported action type: \".concat(action.type));\n      }\n  }\n}\n\nfunction useArtIndex() {\n  _s();\n\n  var context = React.useContext(ArtIndexContext);\n\n  if (context.length === 0) {\n    throw new Error('useArtIndex must be used within ArtIndexProvider');\n  }\n\n  var _context = _slicedToArray(context, 2),\n      state = _context[0],\n      dispatch = _context[1]; // --------------------------------------------------------------------------\n  // Data Fetching\n  // --------------------------------------------------------------------------\n\n\n  React.useEffect(function () {\n    d3.csv('/art-index/data/artists.csv').then(function (artists) {\n      dispatch({\n        type: 'FETCH_ARTISTS',\n        payload: artists\n      });\n    });\n    d3.csv('/art-index/data/works.csv').then(function (works) {\n      dispatch({\n        type: 'FETCH_WORKS',\n        payload: works\n      });\n    });\n  }, [dispatch]);\n  return {\n    state: state,\n    dispatch: dispatch\n  };\n}\n\n_s(useArtIndex, \"wqnYpdjMkT3eDhbBjwDmfBO/TFg=\");\n\nfunction ArtIndexProvider(props) {\n  _s2();\n\n  var _React$useReducer = React.useReducer(reducer, defaultState),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      state = _React$useReducer2[0],\n      dispatch = _React$useReducer2[1];\n\n  var value = React.useMemo(function () {\n    return [state, dispatch];\n  }, [state]);\n  return __jsx(ArtIndexContext.Provider, _extends({\n    value: value\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 10\n    }\n  }));\n}\n\n_s2(ArtIndexProvider, \"4FhbR6GsrG/eoJdDrRGdGqCw6Ls=\");\n\n_c = ArtIndexProvider;\nexport { useArtIndex, ArtIndexProvider };\n\nvar _c;\n\n$RefreshReg$(_c, \"ArtIndexProvider\");","map":{"version":3,"sources":["/Users/luked/Documents/slnsw/dxlab-art-index/lib/contexts/art-index-context.tsx"],"names":["React","d3","d3Array","arrayToCounts","processFormatsByGenderData","processFormatsByGenderToComparisonData","processPriceData","processWorksByYear","ArtIndexContext","createContext","defaultState","isWorksLoading","isArtistsLoading","works","artists","priceData","artistsGenderData","formatByGenderData","formatByGenderComparisonData","genderYearData","worksByYearData","formatsData","all","female","male","unknown","reducer","state","action","type","payload","Array","from","group","d","exhibitionYear","sort","a","b","map","year","allWorks","malesTotal","filter","work","artistGender","length","femalesTotal","mediumFormat","name","firstName","lastName","value","parseInt","worksTotal","gender","Error","useArtIndex","context","useContext","dispatch","useEffect","csv","then","ArtIndexProvider","props","useReducer","useMemo"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as d3 from 'd3';\nimport * as d3Array from 'd3-array';\n\nimport {\n  arrayToCounts,\n  processFormatsByGenderData,\n  processFormatsByGenderToComparisonData,\n  processPriceData,\n  processWorksByYear,\n} from '../art-index-utils';\nimport {\n  ArtIndexArtistType,\n  ArtIndexWorkType,\n} from '../../types/art-index-types';\n\ntype ArtIndexActions =\n  | {\n      type: 'FETCH_WORKS';\n      payload: ArtIndexWorkType[];\n    }\n  | {\n      type: 'FETCH_ARTISTS';\n      payload: ArtIndexArtistType[];\n    };\n\ntype ArtIndexState = {\n  isWorksLoading: boolean;\n  isArtistsLoading: boolean;\n  works: ArtIndexWorkType[];\n  artists: ArtIndexArtistType[];\n  priceData: any[];\n  artistsGenderData: any[];\n  formatByGenderData: any[];\n  formatByGenderComparisonData: any[];\n  genderYearData: any[];\n  worksByYearData: any[];\n  formatsData: any[];\n};\n\nconst ArtIndexContext = React.createContext<\n  [ArtIndexState, React.Dispatch<ArtIndexActions>] | []\n>([]);\n\nconst defaultState = {\n  isWorksLoading: true,\n  isArtistsLoading: true,\n  works: [],\n  artists: [],\n  // Data for charts\n  priceData: [],\n  artistsGenderData: [],\n  formatByGenderData: [],\n  formatByGenderComparisonData: [],\n  genderYearData: [],\n  worksByYearData: [],\n  formatsData: { all: [], female: [], male: [], unknown: [] },\n};\n\nfunction reducer(state, action: ArtIndexActions) {\n  switch (action.type) {\n    case 'FETCH_WORKS': {\n      const works = action.payload;\n      const formatByGenderData = processFormatsByGenderData(works);\n\n      return {\n        ...state,\n        isWorksLoading: false,\n        works,\n        priceData: processPriceData(works),\n        formatByGenderData,\n        formatByGenderComparisonData: processFormatsByGenderToComparisonData(\n          formatByGenderData,\n        ),\n        genderYearData: Array.from(\n          d3Array.group(works, (d) => d.exhibitionYear),\n        )\n          .sort((a, b) => a[0] - b[0])\n          .map((d) => {\n            const year = d[0];\n            const allWorks = d[1];\n\n            return {\n              year,\n              malesTotal: allWorks.filter(\n                (work) => work.artistGender === 'male',\n              ).length,\n              femalesTotal: allWorks.filter(\n                (work) => work.artistGender === 'female',\n              ).length,\n            };\n          }),\n        worksByYearData: processWorksByYear(works),\n        formatsData: {\n          all: arrayToCounts(works.map((work) => work.mediumFormat)),\n          male: arrayToCounts(\n            works\n              .filter((work) => work.artistGender === 'male')\n              .map((work) => work.mediumFormat),\n          ),\n          female: arrayToCounts(\n            works\n              .filter((work) => work.artistGender === 'female')\n              .map((work) => work.mediumFormat),\n          ),\n          unknown: arrayToCounts(\n            works\n              .filter((work) => work.artistGender === '')\n              .map((work) => work.mediumFormat),\n          ),\n        },\n      };\n    }\n\n    case 'FETCH_ARTISTS': {\n      const artists = action.payload;\n\n      return {\n        ...state,\n        isArtistsLoading: false,\n        artists,\n        artistsGenderData: artists\n          .map((d) => {\n            return {\n              name: `${d.firstName} ${d.lastName}`,\n              value: parseInt(d.worksTotal, 10),\n              gender: d.gender,\n            };\n          })\n          .filter((d) => d.gender === 'male' || d.gender === 'female'),\n      };\n    }\n\n    default: {\n      throw new Error(`Unsupported action type: ${action.type}`);\n    }\n  }\n}\n\nfunction useArtIndex() {\n  const context = React.useContext(ArtIndexContext);\n\n  if (context.length === 0) {\n    throw new Error('useArtIndex must be used within ArtIndexProvider');\n  }\n\n  const [state, dispatch] = context;\n\n  // --------------------------------------------------------------------------\n  // Data Fetching\n  // --------------------------------------------------------------------------\n  React.useEffect(() => {\n    d3.csv('/art-index/data/artists.csv').then((artists) => {\n      dispatch({\n        type: 'FETCH_ARTISTS',\n        payload: artists,\n      });\n    });\n\n    d3.csv('/art-index/data/works.csv').then((works) => {\n      dispatch({\n        type: 'FETCH_WORKS',\n        payload: works,\n      });\n    });\n  }, [dispatch]);\n\n  return {\n    state,\n    dispatch,\n  };\n}\n\nfunction ArtIndexProvider(props) {\n  const [state, dispatch] = React.useReducer(reducer, defaultState);\n  const value = React.useMemo(() => [state, dispatch], [state]);\n\n  return <ArtIndexContext.Provider value={value} {...props} />;\n}\n\nexport { useArtIndex, ArtIndexProvider };\n"]},"metadata":{},"sourceType":"module"}