{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/luked/Documents/slnsw/dxlab-art-index/components/ArtIndexExplore/ArtIndexExplore.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport * as d3 from 'd3';\nimport * as d3Array from 'd3-array';\nimport Link from '../Link';\nimport HierarchyColumnBrowser from '../HierarchyColumnBrowser';\nimport Icon from '../Icon';\n\nvar ArtIndexExplore = function ArtIndexExplore() {\n  _s();\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      rawData = _React$useState2[0],\n      setRawData = _React$useState2[1];\n\n  var _React$useState3 = React.useState([]),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      data = _React$useState4[0],\n      setData = _React$useState4[1];\n\n  var _React$useState5 = React.useState([]),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      items = _React$useState6[0],\n      setItems = _React$useState6[1];\n\n  var _React$useState7 = React.useState([{\n    type: 'chooser',\n    id: 0,\n    index: 0,\n    key: null,\n    data: null\n  }]),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      listOfColumns = _React$useState8[0],\n      setListOfColumns = _React$useState8[1];\n\n  var columnTypes = ['chooser', // this one is special\n  'years', 'exhibitions', 'artists', 'works', 'format', 'price', 'gender'];\n  var typeToField = {\n    // this is the field name we use for grouping\n    years: 'exhibitionYear',\n    exhibitions: 'exhibitionName',\n    artists: 'artistId',\n    works: 'id',\n    format: 'mediumFormat',\n    price: 'price',\n    gender: 'artistGender'\n  };\n  React.useEffect(function () {\n    d3.csv( // '/data/australian-art-exhibition-catalogue-index-1845-1900-new.csv',\n    '/art-index/data/works.csv').then(function (newData) {\n      setRawData(newData);\n      var loc = {\n        type: 'chooser',\n        id: 0,\n        index: 0,\n        key: null,\n        data: newData\n      };\n      setListOfColumns([loc]);\n    });\n  }, []);\n  React.useEffect(function () {\n    var columnTypesLocal = ['chooser', // this one is special\n    'years', 'exhibitions', 'artists', 'works', 'format', 'price', 'gender'];\n    var typeToFieldLocal = {\n      // this is the field name we use for grouping\n      years: 'exhibitionYear',\n      exhibitions: 'exhibitionName',\n      artists: 'artistId',\n      works: 'id',\n      format: 'mediumFormat',\n      price: 'price',\n      gender: 'artistGender'\n    };\n    var initialData = columnTypesLocal.map(function (type, i) {\n      var groupingField = typeToFieldLocal[type];\n      var tempGroupedData = d3Array.group(rawData, function (d) {\n        return d[groupingField];\n      });\n      var childCount = tempGroupedData.size;\n      var out = {\n        id: i.toString(),\n        title: type,\n        parentId: 'top',\n        childrenTotal: childCount,\n        type: 'chooser',\n        columnIndex: 0\n      };\n      return out;\n    });\n    initialData.shift();\n    initialData = initialData.sort(function (a, b) {\n      if (a.childrenTotal < b.childrenTotal) {\n        return 1;\n      }\n\n      if (a.childrenTotal > b.childrenTotal) {\n        return -1;\n      }\n\n      return 0;\n    });\n    setData(initialData);\n  }, [rawData]); // , columnTypes, typeToField\n\n  React.useEffect(function () {\n    setItems(data.map(function (d) {\n      if (d.parentId === 'top') {\n        return _objectSpread(_objectSpread({}, d), {}, {\n          parentId: null\n        });\n      }\n\n      return _objectSpread({}, d);\n    }));\n  }, [data]);\n\n  var formatPrice = function formatPrice(p) {\n    if (!p) {\n      return '';\n    }\n\n    var pounds = Math.floor(p);\n    var allPence = Math.round((p - pounds) * 240);\n    var shillings = Math.floor(allPence / 12);\n    var pence = allPence - shillings * 12;\n    return \"\\xA3\".concat(pounds, \" \").concat(shillings, \"s \").concat(pence, \"d\");\n  };\n\n  var doOnChange = function doOnChange(event, _ref) {\n    var item = _ref.item,\n        rowIndex = _ref.rowIndex,\n        listIndex = _ref.listIndex;\n    // remove stuff that will no longer be displayed\n    var prevData = data.filter(function (e) {\n      return e.columnIndex === 0 || e.columnIndex <= listIndex;\n    });\n    var newListOfColumns = listOfColumns.filter(function (e) {\n      return e.index === 0 || e.index <= listIndex;\n    }); // find new data to add\n\n    var newType = item.type === 'chooser' ? item.title : 'chooser';\n    var groupedData;\n    var narrowedData;\n\n    if (item.type === 'chooser') {\n      // group data\n      var dataToWorkOn = newListOfColumns[listIndex].data;\n      var groupBy = typeToField[item.title];\n      groupedData = d3Array.group(dataToWorkOn, function (d) {\n        return d[groupBy];\n      });\n    } else {\n      // narrow data\n      var preNarrowedData = newListOfColumns[newListOfColumns.length - 1].data;\n      narrowedData = preNarrowedData.get(item.key);\n    }\n\n    var newColumnListData = {\n      type: newType,\n      id: item.id,\n      key: item.type === 'chooser' ? null : item.key,\n      index: listIndex + 1,\n      data: item.type === 'chooser' ? groupedData : narrowedData\n    };\n    newListOfColumns.push(newColumnListData);\n    setListOfColumns(newListOfColumns);\n    var newData = [];\n    var currentColumnTypes = newListOfColumns.map(function (d) {\n      return d.type;\n    }).filter(function (d) {\n      return d !== 'chooser';\n    });\n    var otherColumnTypes = columnTypes.filter(function (d) {\n      return currentColumnTypes.indexOf(d) < 0;\n    });\n    otherColumnTypes.shift();\n\n    if (newType === 'chooser') {\n      // new column is a type choosing column\n      newData = otherColumnTypes.map(function (type, i) {\n        var groupingField = typeToField[type];\n        var tempGroupedData = d3Array.group(narrowedData, function (d) {\n          return d[groupingField];\n        });\n        var childCount = tempGroupedData.size;\n        var l = prevData.length + i + 1;\n        var out = {\n          id: l.toString(),\n          title: type,\n          parentId: item.id.toString(),\n          childrenTotal: childCount,\n          type: 'chooser',\n          columnIndex: listIndex + 1\n        };\n        return out;\n      });\n      newData = newData.sort(function (a, b) {\n        if (a.childrenTotal < b.childrenTotal) {\n          return 1;\n        }\n\n        if (a.childrenTotal > b.childrenTotal) {\n          return -1;\n        }\n\n        return 0;\n      });\n    } else {\n      var id = prevData.length;\n      var newDataToId = [];\n      groupedData.forEach(function (value, key) {\n        id += 1;\n        newDataToId[key] = id;\n        var thisTitle;\n\n        if (item.title === 'artists') {\n          thisTitle = value[0].artistFirstName || value[0].artistLastName ? \"\".concat(value[0].artistFirstName, \" \").concat(value[0].artistLastName) : 'unknown';\n        } else if (item.title === 'works') {\n          thisTitle = \"\".concat(value[0].title).concat(value[0].medium || value[0].format ? ' (' : '').concat(value[0].medium).concat(value[0].medium && value[0].format ? ' ' : '').concat(value[0].format).concat(value[0].medium || value[0].format ? ')' : '');\n        } else if (item.title === 'price') {\n          thisTitle = key ? formatPrice(key) : '';\n        } else {\n          thisTitle = key;\n        }\n\n        var link;\n\n        if (item.title === 'artists') {\n          link = \"/art-index/artist/\".concat(value[0].artistId);\n        } else if (item.title === 'works') {\n          link = \"/art-index/work/\".concat(value[0].id);\n        } else if (item.title === 'exhibitions') {\n          link = \"/art-index/exhibition/\".concat(value[0].exhibitionId);\n        } else if (item.title === 'format') {\n          link = \"/art-index/search/?formats=\".concat(value[0].mediumFormat.toLowerCase());\n        } else if (item.title === 'years') {\n          link = \"/art-index/search/?search=\".concat(value[0].exhibitionYear);\n        }\n\n        newData.push({\n          id: id.toString(),\n          title: thisTitle,\n          parentId: item.id,\n          childrenTotal: 0,\n          columnIndex: listIndex + 1,\n          type: newType,\n          key: key,\n          link: link\n        });\n      });\n      newData = newData.sort(function (a, b) {\n        if (a.title < b.title) {\n          return newType === 'price' ? 1 : -1;\n        }\n\n        if (a.title > b.title) {\n          return newType === 'price' ? -1 : 1;\n        }\n\n        return 0;\n      });\n    }\n\n    setData([].concat(_toConsumableArray(prevData), _toConsumableArray(newData)));\n  };\n\n  return __jsx(\"div\", {\n    style: {\n      maxWidth: '80rem',\n      margin: '0 auto'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 5\n    }\n  }, __jsx(HierarchyColumnBrowser, {\n    items: items,\n    originId: \"1\",\n    rowHeight: computeRowHeight,\n    colWidth: computeColWidth,\n    rowComponent: RowComponent,\n    listInfoComponent: ListInfoComponent,\n    onChange: doOnChange // event, { item, rowIndex, listIndex }\n    ,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s(ArtIndexExplore, \"2inHh7zwMr9IBsEgyzmAMGMkuyU=\");\n\n_c = ArtIndexExplore;\n\nvar computeRowHeight = function computeRowHeight(_ref2) {\n  var item = _ref2.item,\n      index = _ref2.index,\n      isSelected = _ref2.isSelected;\n  var height;\n  var chars = 41;\n\n  if (item.type === 'chooser') {\n    height = 40;\n  } else {\n    height = Math.floor(item.title.length / chars) * 20 + 40;\n  }\n\n  return height;\n};\n\nvar computeColWidth = function computeColWidth(_ref3) {\n  var _listItems$, _listItems$2, _listItems$3;\n\n  var listItems = _ref3.listItems,\n      index = _ref3.index;\n  return index % 2 === 0 || ((_listItems$ = listItems[0]) === null || _listItems$ === void 0 ? void 0 : _listItems$.type) === 'gender' || ((_listItems$2 = listItems[0]) === null || _listItems$2 === void 0 ? void 0 : _listItems$2.type) === 'years' || ((_listItems$3 = listItems[0]) === null || _listItems$3 === void 0 ? void 0 : _listItems$3.type) === 'price';\n};\n\nvar RowComponent = function RowComponent(_ref4) {\n  var item = _ref4.item,\n      index = _ref4.index,\n      key = _ref4.key,\n      isSelected = _ref4.isSelected,\n      style = _ref4.style,\n      onClick = _ref4.onClick;\n  return __jsx(\"div\", {\n    key: key,\n    style: _objectSpread({\n      display: 'flex',\n      justifyContent: 'space-between',\n      padding: '0.5em',\n      fontWeight: isSelected ? '500' : '400',\n      // pointerEvents: 'cursor',\n      backgroundColor: index % 2 ? 'rgba(255, 255, 255, 0.05)' : 'transparent',\n      color: isSelected ? 'var(--colour-primary)' : 'var(--colour-white)'\n    }, style),\n    onClick: onClick,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 5\n    }\n  }, __jsx(\"span\", {\n    style: {\n      textTransform: 'capitalize'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 7\n    }\n  }, item.title || 'unknown'), item.link && __jsx(Link, {\n    as: item.link,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 9\n    }\n  }, __jsx(\"a\", {\n    style: {\n      marginLeft: '0.5em'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 11\n    }\n  }, \"view\")), item.childrenTotal ? __jsx(\"span\", {\n    style: {\n      display: 'flex',\n      opacity: 0.8\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 9\n    }\n  }, item.childrenTotal, ' ', __jsx(Icon, {\n    name: \"chevron-forward\",\n    size: \"sm\",\n    colour: \"white\",\n    style: {\n      display: 'flex',\n      marginLeft: '0.5em'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 11\n    }\n  })) : null);\n};\n\n_c2 = RowComponent;\n\nvar ListInfoComponent = function ListInfoComponent(_ref5) {\n  var level = _ref5.level,\n      totalItems = _ref5.totalItems;\n  return __jsx(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      borderTop: '1px solid var(--colour-grey-darkest)',\n      padding: '0.5em',\n      height: '2.5em'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 5\n    }\n  }, __jsx(\"span\", {\n    style: {\n      fontWeight: '600'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 7\n    }\n  }, \"Level \", level), ' ', __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 7\n    }\n  }, totalItems.toLocaleString(), \" items\"));\n}; // const items2 = [\n//   {\n//     title: 'Test 1',\n//     id: '1',\n//     parentId: null,\n//   },\n//   {\n//     title: 'Test 1_1',\n//     id: '1_1',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_2',\n//     id: '1_2',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_3',\n//     id: '1_3',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_1_1',\n//     id: '1_1_1',\n//     parentId: '1_1',\n//   },\n// ];\n\n\n_c3 = ListInfoComponent;\nexport default ArtIndexExplore;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"ArtIndexExplore\");\n$RefreshReg$(_c2, \"RowComponent\");\n$RefreshReg$(_c3, \"ListInfoComponent\");","map":{"version":3,"sources":["/Users/luked/Documents/slnsw/dxlab-art-index/components/ArtIndexExplore/ArtIndexExplore.tsx"],"names":["React","d3","d3Array","Link","HierarchyColumnBrowser","Icon","ArtIndexExplore","useState","rawData","setRawData","data","setData","items","setItems","type","id","index","key","listOfColumns","setListOfColumns","columnTypes","typeToField","years","exhibitions","artists","works","format","price","gender","useEffect","csv","then","newData","loc","columnTypesLocal","typeToFieldLocal","initialData","map","i","groupingField","tempGroupedData","group","d","childCount","size","out","toString","title","parentId","childrenTotal","columnIndex","shift","sort","a","b","formatPrice","p","pounds","Math","floor","allPence","round","shillings","pence","doOnChange","event","item","rowIndex","listIndex","prevData","filter","e","newListOfColumns","newType","groupedData","narrowedData","dataToWorkOn","groupBy","preNarrowedData","length","get","newColumnListData","push","currentColumnTypes","otherColumnTypes","indexOf","l","newDataToId","forEach","value","thisTitle","artistFirstName","artistLastName","medium","link","artistId","exhibitionId","mediumFormat","toLowerCase","exhibitionYear","maxWidth","margin","computeRowHeight","computeColWidth","RowComponent","ListInfoComponent","isSelected","height","chars","listItems","style","onClick","display","justifyContent","padding","fontWeight","backgroundColor","color","textTransform","marginLeft","opacity","level","totalItems","borderTop","toLocaleString"],"mappings":"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","sourcesContent":["import React from 'react';\nimport * as d3 from 'd3';\nimport * as d3Array from 'd3-array';\n\nimport Link from '../Link';\nimport HierarchyColumnBrowser from '../HierarchyColumnBrowser';\nimport Icon from '../Icon';\n\nconst ArtIndexExplore = () => {\n  const [rawData, setRawData] = React.useState([]);\n  const [data, setData] = React.useState([]);\n  const [items, setItems] = React.useState([]);\n\n  const [listOfColumns, setListOfColumns] = React.useState([\n    { type: 'chooser', id: 0, index: 0, key: null, data: null },\n  ]);\n\n  const columnTypes = [\n    'chooser', // this one is special\n    'years',\n    'exhibitions',\n    'artists',\n    'works',\n    'format',\n    'price',\n    'gender',\n  ];\n\n  const typeToField = {\n    // this is the field name we use for grouping\n    years: 'exhibitionYear',\n    exhibitions: 'exhibitionName',\n    artists: 'artistId',\n    works: 'id',\n    format: 'mediumFormat',\n    price: 'price',\n    gender: 'artistGender',\n  };\n\n  React.useEffect(() => {\n    d3.csv(\n      // '/data/australian-art-exhibition-catalogue-index-1845-1900-new.csv',\n      '/art-index/data/works.csv',\n    ).then((newData) => {\n      setRawData(newData);\n      const loc = {\n        type: 'chooser',\n        id: 0,\n        index: 0,\n        key: null,\n        data: newData,\n      };\n      setListOfColumns([loc]);\n    });\n  }, []);\n\n  React.useEffect(() => {\n    const columnTypesLocal = [\n      'chooser', // this one is special\n      'years',\n      'exhibitions',\n      'artists',\n      'works',\n      'format',\n      'price',\n      'gender',\n    ];\n\n    const typeToFieldLocal = {\n      // this is the field name we use for grouping\n      years: 'exhibitionYear',\n      exhibitions: 'exhibitionName',\n      artists: 'artistId',\n      works: 'id',\n      format: 'mediumFormat',\n      price: 'price',\n      gender: 'artistGender',\n    };\n\n    let initialData = columnTypesLocal.map((type, i) => {\n      const groupingField = typeToFieldLocal[type];\n      const tempGroupedData = d3Array.group(rawData, (d) => d[groupingField]);\n      const childCount = tempGroupedData.size;\n      const out = {\n        id: i.toString(),\n        title: type,\n        parentId: 'top',\n        childrenTotal: childCount,\n        type: 'chooser',\n        columnIndex: 0,\n      };\n      return out;\n    });\n    initialData.shift();\n    initialData = initialData.sort((a, b) => {\n      if (a.childrenTotal < b.childrenTotal) {\n        return 1;\n      }\n      if (a.childrenTotal > b.childrenTotal) {\n        return -1;\n      }\n      return 0;\n    });\n    setData(initialData);\n  }, [rawData]); // , columnTypes, typeToField\n\n  React.useEffect(() => {\n    setItems(\n      data.map((d) => {\n        if (d.parentId === 'top') {\n          return {\n            ...d,\n            parentId: null,\n          };\n        }\n        return {\n          ...d,\n        };\n      }),\n    );\n  }, [data]);\n\n  const formatPrice = (p) => {\n    if (!p) {\n      return '';\n    }\n    const pounds = Math.floor(p);\n    const allPence = Math.round((p - pounds) * 240);\n    const shillings = Math.floor(allPence / 12);\n    const pence = allPence - shillings * 12;\n    return `£${pounds} ${shillings}s ${pence}d`;\n  };\n\n  const doOnChange = (event, { item, rowIndex, listIndex }) => {\n    // remove stuff that will no longer be displayed\n    const prevData = data.filter(\n      (e) => e.columnIndex === 0 || e.columnIndex <= listIndex,\n    );\n    const newListOfColumns = listOfColumns.filter(\n      (e) => e.index === 0 || e.index <= listIndex,\n    );\n\n    // find new data to add\n    const newType = item.type === 'chooser' ? item.title : 'chooser';\n    let groupedData;\n    let narrowedData;\n    if (item.type === 'chooser') {\n      // group data\n      const dataToWorkOn = newListOfColumns[listIndex].data;\n      const groupBy = typeToField[item.title];\n      groupedData = d3Array.group(dataToWorkOn, (d) => d[groupBy]);\n    } else {\n      // narrow data\n      const preNarrowedData =\n        newListOfColumns[newListOfColumns.length - 1].data;\n      narrowedData = preNarrowedData.get(item.key);\n    }\n\n    const newColumnListData = {\n      type: newType,\n      id: item.id,\n      key: item.type === 'chooser' ? null : item.key,\n      index: listIndex + 1,\n      data: item.type === 'chooser' ? groupedData : narrowedData,\n    };\n    newListOfColumns.push(newColumnListData);\n    setListOfColumns(newListOfColumns);\n\n    let newData = [];\n    const currentColumnTypes = newListOfColumns\n      .map((d) => {\n        return d.type;\n      })\n      .filter((d) => {\n        return d !== 'chooser';\n      });\n\n    const otherColumnTypes = columnTypes.filter((d) => {\n      return currentColumnTypes.indexOf(d) < 0;\n    });\n    otherColumnTypes.shift();\n\n    if (newType === 'chooser') {\n      // new column is a type choosing column\n      newData = otherColumnTypes.map((type, i) => {\n        const groupingField = typeToField[type];\n        const tempGroupedData = d3Array.group(\n          narrowedData,\n          (d) => d[groupingField],\n        );\n        const childCount = tempGroupedData.size;\n        const l = prevData.length + i + 1;\n        const out = {\n          id: l.toString(),\n          title: type,\n          parentId: item.id.toString(),\n          childrenTotal: childCount,\n          type: 'chooser',\n          columnIndex: listIndex + 1,\n        };\n        return out;\n      });\n\n      newData = newData.sort((a, b) => {\n        if (a.childrenTotal < b.childrenTotal) {\n          return 1;\n        }\n        if (a.childrenTotal > b.childrenTotal) {\n          return -1;\n        }\n        return 0;\n      });\n    } else {\n      let id = prevData.length;\n\n      const newDataToId = [];\n\n      groupedData.forEach((value, key) => {\n        id += 1;\n        newDataToId[key] = id;\n        let thisTitle;\n\n        if (item.title === 'artists') {\n          thisTitle =\n            value[0].artistFirstName || value[0].artistLastName\n              ? `${value[0].artistFirstName} ${value[0].artistLastName}`\n              : 'unknown';\n        } else if (item.title === 'works') {\n          thisTitle = `${value[0].title}${\n            value[0].medium || value[0].format ? ' (' : ''\n          }${value[0].medium}${value[0].medium && value[0].format ? ' ' : ''}${\n            value[0].format\n          }${value[0].medium || value[0].format ? ')' : ''}`;\n        } else if (item.title === 'price') {\n          thisTitle = key ? formatPrice(key) : '';\n        } else {\n          thisTitle = key;\n        }\n\n        let link;\n        if (item.title === 'artists') {\n          link = `/art-index/artist/${value[0].artistId}`;\n        } else if (item.title === 'works') {\n          link = `/art-index/work/${value[0].id}`;\n        } else if (item.title === 'exhibitions') {\n          link = `/art-index/exhibition/${value[0].exhibitionId}`;\n        } else if (item.title === 'format') {\n          link = `/art-index/search/?formats=${value[0].mediumFormat.toLowerCase()}`;\n        } else if (item.title === 'years') {\n          link = `/art-index/search/?search=${value[0].exhibitionYear}`;\n        }\n\n        newData.push({\n          id: id.toString(),\n          title: thisTitle,\n          parentId: item.id,\n          childrenTotal: 0,\n          columnIndex: listIndex + 1,\n          type: newType,\n          key,\n          link,\n        });\n      });\n\n      newData = newData.sort((a, b) => {\n        if (a.title < b.title) {\n          return newType === 'price' ? 1 : -1;\n        }\n        if (a.title > b.title) {\n          return newType === 'price' ? -1 : 1;\n        }\n        return 0;\n      });\n    }\n\n    setData([...prevData, ...newData]);\n  };\n  return (\n    <div style={{ maxWidth: '80rem', margin: '0 auto' }}>\n      <HierarchyColumnBrowser\n        items={items}\n        originId=\"1\"\n        rowHeight={computeRowHeight}\n        colWidth={computeColWidth}\n        rowComponent={RowComponent}\n        listInfoComponent={ListInfoComponent}\n        onChange={doOnChange} // event, { item, rowIndex, listIndex }\n      />\n    </div>\n  );\n};\n\nconst computeRowHeight = ({ item, index, isSelected }) => {\n  let height;\n  const chars = 41;\n  if (item.type === 'chooser') {\n    height = 40;\n  } else {\n    height = Math.floor(item.title.length / chars) * 20 + 40;\n  }\n\n  return height;\n};\nconst computeColWidth = ({ listItems, index }) => {\n  return (\n    index % 2 === 0 ||\n    listItems[0]?.type === 'gender' ||\n    listItems[0]?.type === 'years' ||\n    listItems[0]?.type === 'price'\n  );\n};\n\nconst RowComponent = ({ item, index, key, isSelected, style, onClick }) => {\n  return (\n    <div\n      key={key}\n      style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        padding: '0.5em',\n        fontWeight: isSelected ? '500' : '400',\n        // pointerEvents: 'cursor',\n        backgroundColor:\n          index % 2 ? 'rgba(255, 255, 255, 0.05)' : 'transparent',\n        color: isSelected ? 'var(--colour-primary)' : 'var(--colour-white)',\n        ...style,\n      }}\n      onClick={onClick}\n    >\n      <span\n        style={{\n          textTransform: 'capitalize',\n        }}\n      >\n        {item.title || 'unknown'}\n      </span>\n      {item.link && (\n        <Link as={item.link}>\n          <a\n            style={{\n              marginLeft: '0.5em',\n            }}\n          >\n            view\n          </a>\n        </Link>\n      )}\n      {item.childrenTotal ? (\n        <span style={{ display: 'flex', opacity: 0.8 }}>\n          {item.childrenTotal}{' '}\n          <Icon\n            name=\"chevron-forward\"\n            size=\"sm\"\n            colour=\"white\"\n            style={{ display: 'flex', marginLeft: '0.5em' }}\n          />\n        </span>\n      ) : null}\n    </div>\n  );\n};\n\nconst ListInfoComponent = ({ level, totalItems }) => {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        borderTop: '1px solid var(--colour-grey-darkest)',\n        padding: '0.5em',\n        height: '2.5em',\n      }}\n    >\n      <span style={{ fontWeight: '600' }}>Level {level}</span>{' '}\n      <span>{totalItems.toLocaleString()} items</span>\n    </div>\n  );\n};\n\n// const items2 = [\n//   {\n//     title: 'Test 1',\n//     id: '1',\n//     parentId: null,\n//   },\n//   {\n//     title: 'Test 1_1',\n//     id: '1_1',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_2',\n//     id: '1_2',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_3',\n//     id: '1_3',\n//     parentId: '1',\n//   },\n//   {\n//     title: 'Test 1_1_1',\n//     id: '1_1_1',\n//     parentId: '1_1',\n//   },\n// ];\n\nexport default ArtIndexExplore;\n"]},"metadata":{},"sourceType":"module"}